var arabam;!function(e){var a=function(){var e=this;e.titles=[],e.filters=[],e.selectedFilters=[],e.selectedCategoryFilters=[],e.timeStamp=0,e.count="0",e.url=""};e.LastSearchItem=a;var t=function(){function e(e,t){this.$rootScope=e,this.$window=t,this.currentSessionId="",this.searches=[]}return e.prototype.init=function(){var e=this;return e.isBrowserCompatible()&&(e.prepareSession(),e.readLocalStorage()),e.isBrowserCompatible()},e.prototype.prepareSession=function(){try{var e=sessionStorage.getItem("currentSessionValue");e?this.currentSessionId=e:(this.currentSessionId=this.createGUID(),sessionStorage.setItem("currentSessionValue",this.currentSessionId))}catch(e){console.warn(e)}},e.prototype.saveSearch=function(e,t,r,s){void 0===r&&(r=[]);var a=this;if(a.shouldBeSaved(e,r)){var o=a.prepareSearchItem(e,r);return o.url=t,o.selectedCategoryFilters=r,o.count=s,o.sessionId=a.currentSessionId,a.shouldCreateNew(r)?a.searches.unshift(o):a.searches[0]=o,a.searches.splice(2),a.searches[0]&&a.searches[1]&&a.searches[0].sessionId==a.searches[1].sessionId&&a.searches.splice(1),a.writeLocalStorage(),!0}return!1},e.prototype.shouldBeSaved=function(e,t){return!!this.isBrowserCompatible()&&0<e.filter(function(e){return"view"!=e.PropertyName&&"currency"!=e.PropertyName&&"page"!=e.PropertyName}).length},e.prototype.shouldCreateNew=function(e){var t=this.searches[0];if(!t)return!0;t.selectedCategoryFilters;return t.sessionId!=this.currentSessionId},e.prototype.prepareSearchItem=function(e,t){var r=new a,s="";return e.forEach(function(e){switch(e.PropertyName){case"town":var t=1<e.DisplayName.split("-").length?e.DisplayName.split("-")[1]:e.DisplayName;t[0]=t[0].toUpperCase(),r.filters.push(t);break;case"city":case"fuel":case"tag":case"damagestatus":case"color":case"photo":case"gear":case"membertype":case"bodytype":case"lifeStyle":r.filters.push(e.DisplayName);break;case"category":case"view":case"page":case"currency":case"wizardTag":break;default:r.filters.push(e.Name+": "+e.DisplayName)}}),r.filters=r.filters.filter(this.onlyUnique),t.forEach(function(t){t.forEach(function(e){1==t.length?s+=" "+e.Name:1<e.Level&&(s+=" "+e.Name)}),r.titles.push(s.trim()),s=""}),r.selectedFilters=e,r.timeStamp=Math.floor(Date.now()),r},e.prototype.onlyUnique=function(e,t,r){return r.indexOf(e)===t},e.prototype.remove=function(e){return"number"==typeof e&&(this.searches.splice(e,1),this.writeLocalStorage(),!0)},e.prototype.removeItem=function(e){for(var t=this,r=-1,s=0;s<t.searches.length;s++){t.searches[s].timeStamp==e.timeStamp&&(r=s)}return-1<r&&(t.searches.splice(r,1),t.writeLocalStorage(),!0)},e.prototype.getSearches=function(){return this.searches},e.prototype.getSessionId=function(){return this.currentSessionId},e.prototype.empty=function(){return this.searches=[],this.writeLocalStorage(),!0},e.prototype.writeLocalStorage=function(){try{localStorage.setItem("lastSearches",JSON.stringify(this.searches))}catch(e){return!1}return!0},e.prototype.readLocalStorage=function(){try{var e=localStorage.getItem("lastSearches");e&&(this.searches=JSON.parse(e))}catch(e){return!1}return!0},e.prototype.storageAvailable=function(e){try{var t=this.$window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),!0}catch(e){return!1}},e.prototype.isBrowserCompatible=function(){var e=!1;return(e=this.storageAvailable("localStorage"))||(e=this.storageAvailable("sessionStorage")),e},e.prototype.createGUID=function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(e()+e()+"-"+e()+"-4"+e().substr(0,3)+"-"+e()+"-"+e()+e()+e()).toLowerCase()},e.$inject=["$rootScope","$window"],e}();e.LastSearchService=t,angular.module("arabam").service("LastSearchService",t)}(arabam||(arabam={}));
//# sourceMappingURL=lastSearchesService.min.js.map
