var arabam;!function(e){var r=function(){function e(e,r,t,i){this.CommonHelperService=e,this.HttpHelperService=r,this.DialogService=t,this.$rootScope=i,this.selectedSwapCriterias=[]}return e.prototype.init=function(e){console.log("xxx loaded SwapOpsService"),this.checkSelectedSwapCriterias(e)},e.prototype.checkSelectedSwapCriterias=function(e){var r=this;this.HttpHelperService.httpGet("/search/selectedSwapCriterias"+e,function(e){r.parseSwapFromValidation(e)})},e.prototype.openSwapPopup=function(){var r=this;console.log(this.selectedSwapCriterias),this.DialogService.callSwapFilter({swapInitiator:this.selectedSwapCriterias||null,takasFacetContainer:this.swapInitiatorFacade}).then(function(e){"string"!=typeof e&&(r.swapInitiator=e.reqObj,r.swapInitiatorFacade=e.takasFacetContainer,r.parseSwapFromDialog(e.reqObj))}).catch(function(e){r.DialogService.warning({error:e.Message||e})})},e.prototype.parseSwapFromDialog=function(e){var r=!!e&&e.QueryAsStr[0];if(0!=r.length){this.selectedSwapCriterias=[];for(var t=r.length-1;0<=t;t--){var i=JSON.parse(r[t]);for(var a in i)if(i.hasOwnProperty(a)){var s=""+a,o=i[a];if("mobileproperties"==s.toLowerCase()){s=o[0].Key;var p=o[0].Value[0];o=this.CommonHelperService.isDigit(p)?p:this.CommonHelperService.toFriendlyUrl(p)}if("city"!=s.toLowerCase()&&"category"!=s.toLowerCase()||(o=this.CommonHelperService.isDigit(o)&&"object"!=typeof o?o:o[0]),0==this.selectedSwapCriterias.length||-1==this.CommonHelperService.findInArray(this.selectedSwapCriterias,"PropertyName",s)){var n={PropertyName:s,Items:[{Value:o}]};this.selectedSwapCriterias.push(n)}else{var l=this.CommonHelperService.findInArray(this.selectedSwapCriterias,"PropertyName",s);!!(-1<this.CommonHelperService.findInArray(this.selectedSwapCriterias[l].Items,"Value",o))||this.selectedSwapCriterias[l].Items.push({Value:o})}}console.log(this.selectedSwapCriterias)}this.reWriteUrlBySwap()}else this.selectedSwapCriterias=null},e.prototype.parseSwapFromValidation=function(e){if(!e||e&&0==e.length)return!1;for(var r=e.length-1;0<=r;r--){var t=e[r];if(0==this.selectedSwapCriterias.length||-1==this.CommonHelperService.findInArray(this.selectedSwapCriterias,"PropertyName",t.PropertyName)){var i={PropertyName:t.PropertyName,Items:[{Value:t.Value,Text:t.Text}]};this.selectedSwapCriterias.push(i)}else{var a=this.CommonHelperService.findInArray(this.selectedSwapCriterias,"PropertyName",t.PropertyName);this.selectedSwapCriterias[a].Items.push({Value:t.Value,Text:t.Text})}}this.$rootScope.selectedSwapCount=e.length},e.prototype.clearSwapCriteriasFromUrl=function(){var e,a,r="",t=0,i=(e=window.location.search,a={},e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,r,t,i){a[r]=i}),a);for(var s in i)i.hasOwnProperty(s)&&(-1<s.indexOf("swapCriterias")?delete i[""+s]:(r+=(0==t?"?":"&")+s+"="+i[s],t++));return r=-1==r.indexOf("swap=Evet")?r+"&swap=Evet":r},e.prototype.reWriteUrlBySwap=function(){for(var e=this.selectedSwapCriterias,r=this.clearSwapCriteriasFromUrl(),t=["city","category","minprice","maxprice","minyear","maxyear"],i="",a=e.length-1;0<=a;a--)for(var s=e[a],o=s.Items.length-1;0<=o;o--){var p=s.Items[o];-1<t.indexOf((""+s.PropertyName).toLowerCase())?i+="&swapCriterias."+s.PropertyName+"="+p.Value:i+="&swapCriterias.querystring="+s.PropertyName+"~"+p.Value}window.location.search=r+i},e.$inject=["CommonHelperService","HttpHelperService","DialogService","$rootScope"],e}();angular.module("arabam").service("SwapOpsService",r)}(arabam||(arabam={}));
//# sourceMappingURL=swapOpsService.min.js.map
