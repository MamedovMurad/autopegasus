var arabam;!function(arabam){var AdvertDetailController=function(){function AdvertDetailController(e,t,r,i,o,a,n,l,s,c,d,v,p,m,u,g){var h=this;this.$window=e,this.HttpHelperService=t,this.DialogService=r,this.CompareService=i,this.$scope=o,this.$timeout=a,this.CommonHelperService=n,this.$templateCache=l,this.$rootScope=s,this.PrevNextService=c,this.$location=d,this.$q=v,this.$sce=p,this.$compile=m,this.arabamConfigFactory=u,this.moment=g,this.showNum=!1,this.googletag=window.googletag,this.compareAvailable=!0,this.selectedSlide=0,this.expertiseSliderIndex=1,this.hasLocalStorage=!1,this.showExpertise=!1,this.swapList={},this.crumbToggleWrapper={},this.comparables=[],this.isIe11=!1,this.socialShareTab=!1,this.showHoveredState=!1,this.insuranceLoaded=!1,this.insuranceLoading=!1,this.technicalLoaded=!1,this.equipmentLoading=!1,this.equipmentLoaded=!1,this.counterIndex=0,this.startListeningRootFavIndex=0,this.favTab=!1,this.segmentifyCallHistory={},this.hasSupportForCallApi=!1,this.tooltipIsOpen=!0,this.kaskoInformation={},this.tramerPatternFailed=!1,this.shellImpression=!1,this.setAngularIndexForMainSlider=function(e){h.$scope.$apply(function(){h.selectedSlide=e})},this.lazyLoadCallBack=function(e){var t=h;0!=e.length&&e.forEach(function(e){e.lazyLoaded||function(e){switch(e.lazyLoaded=!0,e.id){case"js-hook-for-observer-aracbilgi":t.getTechSpecs();break;case"js-hook-for-observer-donanim":t.getEquipments();break;case"js-hook-for-observer-takas":t.checkSwapAvailability()}}(e),e.callbacksTriggered||function(e){switch(e.callbacksTriggered=!0,e.id){case"js-hook-for-observer-aciklama":t.CommonHelperService.setDataLayer("Ilan Detay Tab","Açıklama Tab","Click","gaEvent",!0),t.addToSegmentifyBasketByTabs("aciklama");break;case"js-hook-for-observer-boyadegisen":t.CommonHelperService.setDataLayer("Ilan Detay","Hasar Tab","Click","gaEvent",!0),t.addToSegmentifyBasketByTabs("hasar");break;case"js-hook-for-observer-aracbilgi":t.CommonHelperService.setDataLayer("Ilan Detay","Araç Bilgileri Tab","Click","gaEvent",!0),t.addToSegmentifyBasketByTabs("aracbilgi");break;case"js-hook-for-observer-donanim":t.CommonHelperService.setDataLayer("Ilan Detay","Donanım Tab","Click","gaEvent",!0),t.addToSegmentifyBasketByTabs("donanim");break;case"js-hook-for-observer-ekspertiz":t.addToSegmentifyBasketByTabs("ekspertiz");break;case"js-hook-for-observer-takas":t.addToSegmentifyBasketByTabs("takas")}}(e)})},this.init()}return AdvertDetailController.prototype.init=function(){var r=this;r.isIe11=/Trident.*rv[ :]*11\./.test(navigator.userAgent),r.compareAvailable=r.CompareService.init(),r.advertEquipments=window.advertEquipments,r.categoryId=window.categoryId,r.hasLocalStorage=this.CommonHelperService.storageAvailable("localStorage"),r.registerListeners(),r.checkIfReferrerIsListingPage(),r.setPopState(),r.interceptCtrlSAndShowFavoriteBox(),r.bindSegmentifyCallbacks(),r.segmentifyCallHistory={ikinciFotoyaTiklandi:!1,buyukFotoyaBakildi:!1,favoriyeEklendi:!1,iletisimeGecTiklandi:!1,segmentifyCallHistory:!1,tablardaGezildi:[]},r.compareAvailable&&(r.comparables=r.CompareService.getCarList()),r.$scope.$on("deleteCarFromCompare",function(e,t){r.removeFromCompare(t.id)}),r.$timeout(function(){r.initiateCustomLazyLoaders(),r.initSliders(),r.getLastVisitedAdverts(),r.listenTabObservers()},15),r.checkSendMessageTrigger(),r.isWideScreen=1220<=window.innerWidth,r.checkImpressionForShellAd()},AdvertDetailController.prototype.checkImpressionForShellAd=function(){document.getElementById("js-hook-for-shell-ad")},AdvertDetailController.prototype.offsetOfElement=function(e){var t=e.getBoundingClientRect(),r=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+i,left:t.left+r,height:t.height}},AdvertDetailController.prototype.starredNumber=function(e){var t=e.substr(0,e.length-5)+"** **";this.mobilephone=t},AdvertDetailController.prototype.checkSendMessageTrigger=function(){var t=this;new RegExp("send(m|M)essage=(true|1)").test(window.location.search)&&(this.toggleIletisim=!0,setTimeout(function(){var e=angular.element("#sendMessageButton");e.length?e.triggerHandler("click"):t.DialogService.warning({error:"Kullanıcı mesaj gönderme özelliğini kullanmamaktadır."})}))},AdvertDetailController.prototype.openCallApiConfirmDialog=function(){var t=this;this.hasSupportForCallApi&&(this.CommonHelperService.setDataLayer("Ilan Detay","BiGörelim",null,"gaEvent",!0),this.DialogService.callApiAgreement().then(function(e){t.CommonHelperService.setDataLayer("Ilan Detay","BiGörelim-BilgilendirmeOnay",null,"gaEvent",!0),window.open(t.callApiUrl,"_blank")}).catch(function(e){return t.CommonHelperService.setDataLayer("Ilan Detay","BiGörelim-BilgilendirmeVazgec",null,"gaEvent",!0)}))},AdvertDetailController.prototype.checkIfReferrerIsListingPage=function(){if(this.hasLocalStorage){var e=localStorage.getItem("historyLength"),t=-1!==document.referrer.indexOf("ikinci-el");if(e&&!t&&this.CommonHelperService.getCookie("listingsPopupHasBeenShowed"))return;var r=function(){var e=""+window.history.length;window.removeEventListener("unload",r),localStorage.setItem("historyLength",e)};window.addEventListener("unload",r)}},AdvertDetailController.prototype.registerListeners=function(){var r=this;r.$scope.$on("prevNext",function(e,t){t&&"goPrev"===t?r.goPrev():t&&"goNext"===t&&r.goNext()})},AdvertDetailController.prototype.initiateCustomLazyLoaders=function(){var t=this,e=document.querySelectorAll(".js-hook-for-multiple-lazy-sophisticated");this.lazyLoadableImages=e,window.lazyLoadReady.then(function(){t.newLazyLoad=new window.LazyLoad({data_src:"src-sophisticated",callback_finish:function(){Array.prototype.slice.call(e).filter(function(e){return e.classList.contains("loading")}).forEach(function(e){t.newLazyLoad.load(e,!0)})}},e)}).catch(function(){console.warn("lazyLoad initiate edilmedi")})},AdvertDetailController.prototype.initSliders=function(){var t=this,e=document.getElementById("js-hook-for-main-slider"),r=document.getElementById("js-hook-for-thumbnail-slider"),i=document.getElementById("js-hook-for-no-slider"),o=this.isWideScreen;i||(this.mainDetailSlider=new Flickity(e,{draggable:!1,contain:!0,pageDots:!1,prevNextButtons:!1}),this.mainThumbnailSlider=new Flickity(r,{groupCells:o?6:4,freeScroll:!1,prevNextButtons:!1,wrapAround:!1,draggable:!1,pageDots:!1,contain:!1,lazyLoad:!0,asNavFor:e}),this.mainDetailSlider.on("settle",function(e){t.setAngularIndexForMainSlider(e)}),this.mainDetailSlider.once("change",function(e){!function(){if(0<t.lazyLoadableImages.length&&-1==t.newLazyLoad._elements.indexOf(t.lazyLoadableImages[0])){var e=Array.prototype.slice.call(t.lazyLoadableImages);t.newLazyLoad._elements=Array.prototype.concat.call(t.newLazyLoad._elements,e)}t.newLazyLoad._elements.forEach(function(e){e.removeAttribute("data-was-processed")}),"function"==typeof t.newLazyLoad.loadAll&&t.newLazyLoad.loadAll()}()}),this.registerSliderArrowEvents())},AdvertDetailController.prototype.registerSliderArrowEvents=function(){var e=this,t=document.getElementById("js-hook-for-main-slider"),r=document.getElementById("js-hook-for-thumbnail-slider");r&&r.parentNode.querySelector(".smg-next")&&(r.parentNode.querySelector(".smg-next").addEventListener("click",function(){e.mainThumbnailSlider.next(!0,!0),e.CommonHelperService.setDataLayer("Ilan Detay","Thumbnail Slider - Sonraki","Click","gaEvent",!0)},!1),r.parentNode.querySelector(".smg-prev").addEventListener("click",function(){e.mainThumbnailSlider.previous(!0,!0),e.CommonHelperService.setDataLayer("Ilan Detay","Thumbnail Slider - Onceki","Click","gaEvent",!0)},!1)),t&&t.parentNode.querySelector(".smg-next")&&(t.parentNode.querySelector(".smg-next").addEventListener("click",function(){e.mainDetailSlider.next(!0,!0),e.setAngularIndexForMainSlider(e.mainDetailSlider.selectedIndex),e.CommonHelperService.setDataLayer("Ilan Detay","Kucuk Fotograf - Sonraki","Click","gaEvent",!0)}),t.parentNode.querySelector(".smg-prev").addEventListener("click",function(){e.mainDetailSlider.previous(!0,!0),e.setAngularIndexForMainSlider(e.mainDetailSlider.selectedIndex),e.CommonHelperService.setDataLayer("Ilan Detay","Kucuk Fotograf - Onceki","Click","gaEvent",!0)}))},AdvertDetailController.prototype.initThumbnailSlider=function(e){var a=this,n=this,i=e-1,o=[],l=function(e){if(-1===o.indexOf(e)&&e!==i){var t=function(e){var t=document.getElementById("js-hook-expertise-slider-preload-"+e);t&&t.setAttribute("src",t.getAttribute("preloader"))},r=e===i?0:e+1;t(0===e?i:e-1),t(r),o.push(e)}};this.$timeout(function(){var e=document.getElementById("js-hook-expertise-slider"),t=document.getElementById("js-hook-expertise-slider-left"),r=document.getElementById("js-hook-expertise-slider-right"),i=function(e){n.$scope.$apply(function(){a.expertiseSliderIndex=e+1})},o=new Siema({selector:e,loop:!0,onInit:function(){var e=this;i(this.currentSlide),n.$timeout(function(){l(e.currentSlide)},20)},onChange:function(){i(this.currentSlide),l(this.currentSlide)}});t.addEventListener("click",function(){return o.prev()}),r.addEventListener("click",function(){return o.next()})},23)},AdvertDetailController.prototype.listenTabObservers=function(){var i=this,t=this,r=["js-hook-for-observer-aracbilgi","js-hook-for-observer-donanim","js-hook-for-observer-takas","js-hook-for-ing-credit"],e=["js-hook-for-observer-aciklama","js-hook-for-observer-boyadegisen","js-hook-for-observer-aracbilgi","js-hook-for-observer-donanim","js-hook-for-observer-ekspertiz","js-hook-for-observer-takas","js-hook-for-ing-credit","js-hook-for-shell-ad"].filter(function(e){return!!document.getElementById(e)}),o=e.map(function(e){return document.getElementById(e)});this.tabsWithState=e.map(function(e){return{id:e,isVisible:!1,callbacksTriggered:!1}}),this.tabsWithState.forEach(function(e){-1!=r.indexOf(e.id)&&(e.lazyLoaded=!1)});var a=window.debounce(function(){var e=t.tabsWithState.filter(function(e){return e.isVisible});i.$scope.$apply(function(){i.visibleHighPriorityTab=0<e.length?e[0].id:""}),i.lazyLoadCallBack(e)},166),n=new IntersectionObserver(function(e){e.forEach(function(t){var e=i.tabsWithState.filter(function(e){return e.id==t.target.id})[0],r=e.isVisible;e.isVisible=t.isIntersecting,e.isVisible!=r&&a()})},{rootMargin:"-112px 1px 1px 1px"});o.forEach(function(e){n.observe(e)}),this.observeFooterAndDetail(),this.observeSmallViewPortSticky()},AdvertDetailController.prototype.observeFooterAndDetail=function(){var e=["js-hook-for-observer-detail"].map(function(e){return document.getElementById(e)}),r=document.getElementById("js-hook-for-style-b4nner"),i=document.getElementById("js-hook-for-style-cta"),o=document.getElementById("js-hook-for-scroll-sdt"),a=document.getElementById("breadcrumbShell"),n=document.getElementById("wrapper").querySelector(".container").offsetLeft;o.classList.remove("dn");var l=window.debounce(function(e){n=document.getElementById("wrapper").querySelector(".container").offsetLeft;var t=i.offsetHeight+25+30;e?(a.classList.remove("dn"),o.classList.remove("sdt-open"),r.classList.remove("detail-sticky-sidebar-banner"),r.classList.remove("dss-show"),r.removeAttribute("style"),i.removeAttribute("style"),i.classList.remove("detail-sticky-sidebar-cta"),i.classList.remove("dss-show"),i.classList.add("light-box-shadow")):(a.classList.add("dn"),o.classList.add("sdt-open"),r.classList.add("detail-sticky-sidebar-banner"),r.classList.add("dss-show"),r.style.top=t+"px",i.style.right=n+"px",r.style.right=n+"px",i.classList.add("detail-sticky-sidebar-cta"),i.classList.add("dss-show"),i.classList.remove("light-box-shadow"))},34);window.addEventListener("resize",window.debounce(function(){var e,t,r,i,o,a=document.getElementById("js-hook-for-observer-detail"),n=(e=a.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth,i=e.top<=t&&0<=e.top+e.height,o=e.left<=r&&0<=e.left+e.width,i&&o);l(n)},501));var t=new IntersectionObserver(function(e){e.forEach(function(e){l(e.isIntersecting)})});e.forEach(function(e){t.observe(e)})},AdvertDetailController.prototype.observeSmallViewPortSticky=function(){var e=document.getElementById("js-hook-for-observer-tabs-wrapper"),t=document.getElementById("js-hook-for-observer-small-sticky"),r=document.getElementById("js-hook-for-observer-detail"),i=window.debounce(function(e){e?(r.classList.remove("sdt-nav-bottom-padder"),t.classList.remove("sdt-nav-sticky")):(r.classList.add("sdt-nav-bottom-padder"),t.classList.add("sdt-nav-sticky"))},51);new IntersectionObserver(function(e){e.forEach(function(e){i(e.isIntersecting)})},{rootMargin:"70px 1px 1px 1px"}).observe(e)},AdvertDetailController.prototype.resolveTabById=function(e){var t=e||"wrapper",r=document.getElementById(t),i=document.getElementById("header"),o=0;if(i){var a=window.getComputedStyle(i,null).getPropertyValue("padding-top");o=Number(a.replace("px",""))}$("html,body").animate({scrollTop:r.offsetTop+(e?27:0)+o},400)},AdvertDetailController.prototype.dblClickToViewInLightbox=function(e){this.callLightBox(e)},AdvertDetailController.prototype.addToSegmentifyBasket=function(e){var t=window.adPrice||1;this.segmentifyCallHistory&&(this.segmentifyCallHistory[e]||(this.CommonHelperService.setSegmentifyBasket(this.advertId,t),this.segmentifyCallHistory[e]=!0))},AdvertDetailController.prototype.addToSegmentifyBasketByTabs=function(e){var t=window.adPrice||1;this.segmentifyCallHistory&&(-1!==this.segmentifyCallHistory.tablardaGezildi.indexOf(e)||(this.CommonHelperService.setSegmentifyBasket(this.advertId,t),this.segmentifyCallHistory.tablardaGezildi.push(e)))},AdvertDetailController.prototype.addToSegmentifyCheckout=function(){var e=window.adPrice||1;this.segmentifyCallHistory&&(this.segmentifyCallHistory.iletisimeGecTiklandi||(this.CommonHelperService.setSegmentifyCheckout(this.advertId,e),this.segmentifyCallHistory.iletisimeGecTiklandi=!0))},AdvertDetailController.prototype.askQuestionToSellerSegmentify=function(){var e=window.adPrice||1;this.segmentifyCallHistory&&(this.segmentifyCallHistory.saticiyaSorTiklandi||(this.CommonHelperService.setSegmentifyCheckout(this.advertId,e),this.segmentifyCallHistory.saticiyaSorTiklandi=!0))},AdvertDetailController.prototype.callLightBox=function(e){var r=this;if(window.photosArray){var i=$("body"),t=this.isIe11?"":"lg-start-zoom";r.CommonHelperService.setDataLayer("Ilan Detay","Foto Click / Fotograf devami","Click","gaEvent",!0),r.addToSegmentifyBasket("buyukFotoyaBakildi"),i.lightGallery({dynamic:!0,dynamicEl:window.photosArray,preload:1,speed:0,closable:!1,download:!1,enableDrag:!1,mode:"lg-fade",startClass:t,zoom:!0,fullScreen:!0,hash:!1,index:e,thumbnail:!0}),r.$rootScope.$broadcast("doOperation",{function:"deRegisterListeners"}),i.on("onCloseAfter.lg",function(e){var t=i.data("lightGallery");t&&t.destroy(!0),r.$rootScope.$broadcast("doOperation",{function:"registerListeners"})}),i.on("onBeforeSlide.lg",function(e,t,r,i,o){r===window.photosArray.length-1?$(".lg-sub-html").addClass("gallery-overlay"):$(".lg-sub-html").removeClass("gallery-overlay")}),i.on("onAfterOpen.lg",function(e){var t=e.target;t&&(t.querySelector(".lg-next").addEventListener("click",function(){r.CommonHelperService.setDataLayer("Ilan Detay","Buyuk Fotograf - Sonraki","Click","gaEvent",!0)}),t.querySelector(".lg-prev").addEventListener("click",function(){r.CommonHelperService.setDataLayer("Ilan Detay","Buyuk Fotograf - Onceki","Click","gaEvent",!0)}))})}},AdvertDetailController.prototype.toggleSocialShare=function(){var e=document.getElementById("js-hook-overlay-mediocre-social");this.socialShareTab=!this.socialShareTab,e.style.display=this.socialShareTab?"block":"none"},AdvertDetailController.prototype.toggleMouseEnterSocialShare=function(){document.getElementById("js-hook-overlay-mediocre-social").style.display=this.socialShareTab?"block":""},AdvertDetailController.prototype.toggleMouseLeaveSocialShare=function(){document.getElementById("js-hook-overlay-mediocre-social").style.display=this.socialShareTab?"none":""},AdvertDetailController.prototype.toggleFav=function(e){var t=this;if(!t.favorited||e){var r=document.getElementById("js-hook-overlay-mediocre-fav");t.favTab=!e&&!t.favorited,r&&(r.style.display=t.favTab?"block":"none"),t.listenFavOps()}else t.removeFav()},AdvertDetailController.prototype.listenFavOps=function(){var r=this;0<this.startListeningRootFavIndex||(this.startListeningRootFavIndex++,this.$rootScope.$on("fapFav",function(e,t){r.favorited=t,r.addToSegmentifyBasket("favoriyeEklendi"),r.substractFavCountInDom()}))},AdvertDetailController.prototype.substractFavCountInDom=function(){var e=document.getElementById("header-favorites-wrapper"),t=document.getElementById("js-hook-for-header-unread-fav-count"),r=e?e.querySelector(".inner"):t.querySelector("span"),i=this.$rootScope.UnreadFavCount;r.innerHTML=""+i,0<i&&e.classList.add("active")},AdvertDetailController.prototype.removeFav=function(){var t=this;this.HttpHelperService.httpDelete("/ilan/favorisil?Id="+this.advertId,function(e){e.Success&&(t.favorited=!1,t.$rootScope.UnreadFavCount=+t.$rootScope.UnreadFavCount-1,t.CommonHelperService.setDataLayer("Ilan Detay","Favoriden Çıkar","Click","gaEvent"),t.substractFavCountInDom())},{},{isNotLoading:!0})},AdvertDetailController.prototype.getTechSpecs=function(){var o=this,a=this;if(!a.technicalLoaded){var e="/advertDetail/details?id="+a.advertId;"/ilan-gecmis"==window.location.pathname&&(e="/advertDetail/historydetails?id="+a.advertId),a.HttpHelperService.httpGet(e,function(e){var t=o.$sce.trustAsHtml(e),r=o.$sce.valueOf(t),i=document.getElementById("js-hook-appendable-technicalPropertiesWrapper");i.innerHTML+=r,a.$compile(i)(a.$scope)},function(){console.log("error")},{isNotLoading:!0}),a.technicalLoaded=!a.technicalLoaded}},AdvertDetailController.prototype.openExpertise=function(e){if(window.expertiseArray){var t=e||0,r=$("html"),i=this.isIe11?"":"lg-start-zoom";r.lightGallery({dynamic:!0,thumbnail:!1,preload:1,speed:0,closable:!1,download:!1,enableDrag:!1,mode:"lg-fade",startClass:i,zoom:!0,dynamicEl:window.expertiseArray,fullScreen:!0,hash:!1,index:t}),r.one("onCloseAfter.lg",function(e){var t=r.data("lightGallery");t&&t.destroy(!0)})}},AdvertDetailController.prototype.checkSwapAvailability=function(){var t=this;t.CommonHelperService.compareObjects(t.swapList,{})&&t.HttpHelperService.httpGet("/ilan/takas-kriterleri?id="+t.advertId,function(e){e.Success&&(t.swapList=e.Data)},{},{isNotLoading:!0})},AdvertDetailController.prototype.callLoginDialog=function(e){this.DialogService.closeAll(),this.DialogService.callLogin({callBack:e})},AdvertDetailController.prototype.sendMsg=function(e,t,r,i){var o=this,a=i||"";o.$rootScope.Properties.IsUserLoggedIn?o.sendMsgCallBack(e,t,r,a):o.callLoginDialog(function(){o.DialogService.closeAll(),o.sendMsgCallBack(e,t,r,a,window.location.href)})},AdvertDetailController.prototype.sendMsgCallBack=function(e,t,r,i,o){var a=this,n=this,l={advertId:e,advertTitle:r,to:t};this.HttpHelperService.httpPost("/ilan/mesajlasma",l,function(e){e.Data.HasConversation?window.location.href="/panelim/mesajlar/gelen/"+e.Data.Id:(l.id=e.Data.Id,l.hasConversation=e.Data.HasConversation,l.SwapOption=e.Data.SwapOption,e.Data.Subject&&(l.subject=e.Data.Subject),i&&(l.advertMsg=i),e.Data.QuestionTemplates&&(l.QuestionTemplates=e.Data.QuestionTemplates),l.goto=o,n.$rootScope.$broadcast("doOperation",{function:"deRegisterListeners"}),a.DialogService.textInput(l).then(function(){n.$rootScope.$broadcast("doOperation",{function:"registerListeners"})}).catch(function(){n.$rootScope.$broadcast("doOperation",{function:"registerListeners"})}),!0)},null,{isNotLoading:!0})},AdvertDetailController.prototype.openErrorReporting=function(e){var t=this,r={advertId:e};t.$rootScope.Properties.IsUserLoggedIn?t.DialogService.openErrorReportingDialog(r):t.callLoginDialog(function(){t.DialogService.closeAll(),t.DialogService.openErrorReportingDialog(r)})},AdvertDetailController.prototype.getUrl=function(e){return"localhost"===window.location.hostname?window.location.origin+e:window.location.origin.replace("http://","https://")+e},AdvertDetailController.prototype.showNumber=function(e){var t=document.querySelector(".detail-sticky-sidebar-banner");if(!this.showNum){var r=new XMLHttpRequest;r.open("GET","//istatistik.arabam.com/viewcounter.ashx?objectname=AdvertPhoneShow&objectid="+e,!0),r.onload=function(e){if(200<=e.status&&e.status<400)e.response},r.onerror=function(){},r.send();var i=document.createElement("iframe");i.src="//creativecdn.com/tags?id=pr_u3WCA4IpKqVn38r8wqss_orderstatus2_1.00_call_"+e+"&cd=default",i.name="frame1",i.id="frame1",i.width="1",i.height="1",i.frameBorder="0",i.style.display="none",document.body.appendChild(i)}this.showNum=!0,this.$timeout(function(){if(t){var e=document.querySelector(".detail-sticky-sidebar-cta").offsetHeight+20+30;t.style.top=e+"px"}},15)},AdvertDetailController.prototype.showAllNumbers=function(){if(this.$templateCache){var e=this.$templateCache.get("kurumsal-numaralar.html");this.DialogService.mobileIletisim({content:e})}},AdvertDetailController.prototype.facebookShare=function(e,t,r,i){this.DialogService.facebookFeedShare(e,t,r,i),this.CommonHelperService.setDataLayer("Ilan Detay","Paylaş","Facebook","gaEvent",!0)},AdvertDetailController.prototype.removeAdvert=function(e,t,r,i){var o=t,a=i.split(" ");this.DialogService.disableOrRemoveAdvertDialogWoState({advert:e,memberType:this.memberType,status:r,price:a[0],currency:a[1],title:"İlanınız Silinecek",endpoint:"/api/delete-advertV2",subtitle:"İlanınızı neden silmek istiyorsunuz?",message:"' "+o+"' ilanınızı yayından kaldırmak istediğinizden emin misiniz? İlanınıza bağlı varsa Otorapor ekspertiz randevunuz da iptal edilecektir.",messageArchive:"' "+o+"' ilanınız kalıcı olarak silinecek. ",warningArchive:"İlanınızı silmek istediğinizden emin misiniz?",errorMessage:"Lütfen bir neden seçiniz.",successMessage:"İlanınız silinmiştir.",confirm:"Sil",cancel:"Vazgeç",ShowAsSold:!1}).then(function(){setTimeout(function(){window.location.reload()},400)})},AdvertDetailController.prototype.updateDate=function(e,t){var r=this,i=t;r.DialogService.openConfirm(function(){r.HttpHelperService.httpPost("/ilan/tarihguncelle",{id:e},function(e){e.Success&&r.DialogService.success({message:"Ilanınızın süresi uzatılmıştır"})})},{bodyOptions:{message:"'"+i+"' ilanının tarihini güncellemek istediğinizden emin misiniz?"}})},AdvertDetailController.prototype.changePrice=function(e,t){var r=this,i={AdvertId:e,Price:t};this.DialogService.changePrice(i).then(function(e){"string"!=typeof e.value&&r.HttpHelperService.httpPostWithPromise("/api/update-advert-price",e.value).then(function(e){e.Success?window.location.reload():(console.warn(e),r.DialogService.warning({error:e.Message}))}).catch(function(e){r.DialogService.warning({error:e.Message})})})},AdvertDetailController.prototype.editAdvert=function(e){var t="/panelim/ilan-duzenle?advertId="+e;this.$window.open(t,"_self")},AdvertDetailController.prototype.addTurbo=function(e){var t="/panelim/ilan-ver/urun-ekle?advertId="+e+"&hide=1";this.$window.open(t,"_self")},AdvertDetailController.prototype.useTurbo=function(e){this.$window.open("/panelim/ilanlar/turbolar/anasayfa","_self")},AdvertDetailController.prototype.unpublishAdvert=function(e,t,r,i,o){var a=t,n=i.split(" ");this.DialogService.disableOrRemoveAdvertDialogWoState({advert:e,status:r,price:n[0],currency:n[1],title:"İlanınız Yayından Kaldırılacak",endpoint:"/panelim/api/unpublishadvertv2",subtitle:"İlanınızı neden yayından kaldırmak istiyorsunuz?",message:"'"+a+"' ilanınızı yayından kaldırmak istediğinizden emin misiniz? İlanınıza bağlı varsa Otorapor ekspertiz randevunuz da iptal edilecektir.",errorMessage:"Lütfen bir neden seçiniz.",successMessage:"İlanınız yayından kaldırılmıştır",confirm:"Yayından Kaldır",cancel:"Vazgeç",ShowAsSold:!1})},AdvertDetailController.prototype.publishAdvert=function(e,t){var r=this,i=t;this.DialogService.openConfirm(function(){r.HttpHelperService.httpPost("/ilan/yayinaal",{id:e},function(e){!0===e.Success&&r.DialogService.successWithReload({message:"Ilanınız yayına alınmıştır"})})},{bodyOptions:{message:"'"+i+"' ilanını yayına almak istediğinizden emin misiniz?"}})},AdvertDetailController.prototype.setAdvert=function(e){var t=document.getElementById(e),r=this.toAdvert(t);if(this.hasLocalStorage){var i=localStorage.getItem("visitedAdverts_v3"),o=this.CommonHelperService.getCookie("avSessionId"),a={ASessionID:this.CommonHelperService.getCookie("ASessionID"),Session:o,Adverts:[]},n=JSON.parse(i);if(a.Adverts.push(r),!i||n.ASessionID&&n.Session!==o)localStorage.setItem("visitedAdverts_v3",JSON.stringify(a));else{n.Session===o||n.ASessionID||(n.Session=o);var l=this.CommonHelperService.findInArray(n.Adverts,"id",r.id);-1<l?n.Adverts.splice(l,1):12<=n.Adverts.length&&n.Adverts.splice(n.Adverts.length-1,1),n.Adverts.unshift(r),localStorage.setItem("visitedAdverts_v3",JSON.stringify(n))}}},AdvertDetailController.prototype.toAdvert=function(e){return{title:e.dataset.title,modelname:e.dataset.modelname,url:e.dataset.url,formattedPrice:e.dataset.formattedprice,image:e.dataset.image,year:e.dataset.year,session:e.dataset.session}},AdvertDetailController.prototype.getLastVisitedAdverts=function(){if(!this.hasLocalStorage)return[];var e=localStorage.getItem("visitedAdverts_v3");if(!e)return[];var t=JSON.parse(e);this.visitedAdverts=t.Adverts},AdvertDetailController.prototype.getExpertiseStatus=function(e,t){var r=this;r.$timeout(function(){r.HttpHelperService.httpGet("/ilan/ekspertiz/"+e+"/"+t,function(e){r.showExpertise=e.Success},function(e){r.showExpertise=!1},{isNotLoading:!0})},21)},AdvertDetailController.prototype.getEquipments=function(){var o=this,a=o.$q.defer();return o.equipmentLoaded||(o.equipmentLoading=!0,this.HttpHelperService.httpGetWithPromise("/advertDetail/equipments?id="+o.advertId,{isNotLoading:!0}).then(function(e){var t=o.$sce.trustAsHtml(e),r=o.$sce.valueOf(t),i=document.getElementById("equipmentWrapper");i.innerHTML=r,o.$compile(i)(o.$scope),o.equipmentLoaded=!0,o.equipmentLoading=!1,a.resolve()}).catch(function(){o.equipmentLoaded=!1,o.equipmentLoading=!1,a.reject()})),a.promise},AdvertDetailController.prototype.checkIfInCompare=function(e){return this.CompareService.checkIfInCompare(e)},AdvertDetailController.prototype.getIndexOfCompare=function(e){return this.CompareService.getIndex(e)},AdvertDetailController.prototype.toggleCompare=function(e){console.log("toggleCompare advertDetail");var t=this;try{t.checkIfInCompare(e.id)?t.CommonHelperService.setDataLayer("Ilan Detay","Karşılaştırmadan Çıkar","Click","gaEvent",!0):t.CommonHelperService.setDataLayer("Ilan Detay","Karşılaştırmaya Ekle","Click","gaEvent",!0),console.log("self.CompareService.toggle from detail"),t.CompareService.toggle(e)}catch(e){this.$rootScope.isMobile&&t.DialogService.warning({error:"En Fazla 3 adet ilan karşılaştırabilirsiniz. Dilerseniz karşılaştırma adımına devam edebilir ya da eklediğiniz ilanlardan birini çıkartıp yeni bir ilan ekleyebilirsiniz.",title:"En Fazla 3 İlan Karşılaştırabilirsiniz"}),t.CommonHelperService.setDataLayer("Ilan Karşılaştırma","Ilan-Karsilastirma-Limit-Uyari","Alertbox","gaEvent",!0)}this.comparables=t.CompareService.getCarList()},AdvertDetailController.prototype.removeFromCompare=function(e){this.CompareService.remove(e),this.comparables=this.CompareService.getCarList()},AdvertDetailController.prototype.goPrev=function(){var r=this;r.CommonHelperService.setDataLayer("Ilan Detay","Önceki Ilan","Click","gaEvent",!0);var e=r.PrevNextService.getPreviousAdvertData(r.advertId);if(e&&0==e.advertId&&(r.PrevNextService.setCurrentAdvert(e.advertId),e=r.PrevNextService.getPreviousAdvertData(e.advertId)),e)r.PrevNextService.setCurrentAdvert(e.advertId),r.$window.location.href=e.advertUrl;else{var t=r.$location.search(),i=r.PrevNextService.currentPage,o=r.PrevNextService.totalPage;if(i<=o){t.page=i-1;var a=r.PrevNextService.searchUrl;a=r.CommonHelperService.updateQueryStringParameter(a,"page",t.page),r.getListingFromApi(a).then(function(e){if(e.Success&&e.Documents&&0<e.Documents.length){i-=1;var t=e.Documents.map(function(e){return{advertId:e.Id,advertUrl:e.Url}});r.PrevNextService.adverts=t,r.PrevNextService.currentPage=i,r.PrevNextService.searchUrl=a,r.PrevNextService.writeLocalStorage(),r.goPrev()}})}}},AdvertDetailController.prototype.goNext=function(){var r=this;r.CommonHelperService.setDataLayer("Ilan Detay","Sonraki Ilan","Click","gaEvent",!0);var e=r.PrevNextService.getNextAdvertData(r.advertId);if(e&&0==e.advertId&&(r.PrevNextService.setCurrentAdvert(e.advertId),e=r.PrevNextService.getNextAdvertData(e.advertId)),e)r.PrevNextService.setCurrentAdvert(e.advertId),r.$window.location.href=e.advertUrl;else{var t=r.$location.search(),i=r.PrevNextService.currentPage,o=r.PrevNextService.totalPage;if(i<=o){t.page=i+1;var a=r.PrevNextService.searchUrl;a=r.CommonHelperService.updateQueryStringParameter(a,"page",t.page),r.getListingFromApi(a).then(function(e){if(e.Success&&e.Documents&&0<e.Documents.length){i+=1;var t=e.Documents.map(function(e){return{advertId:e.Id,advertUrl:e.Url}});r.PrevNextService.adverts=t,r.PrevNextService.currentPage=i,r.PrevNextService.searchUrl=a,r.PrevNextService.writeLocalStorage(),r.goNext()}})}}},AdvertDetailController.prototype.getListingFromApi=function(e){return this.HttpHelperService.httpGetWithPromise("/listing/SearchByUrl?url="+window.location.origin+encodeURIComponent(e))},AdvertDetailController.prototype.setPopState=function(){var t=this;t.$window.onpopstate=function(e){t.$scope.$apply(function(){-1<e.target.location.href.indexOf("ikinci-el")&&(t.$window.location=e.target.location.href)})}},AdvertDetailController.prototype.checkIfReferrerIsGalleryPage=function(){var e=this;-1<e.$window.document.referrer.indexOf("/galeri/")&&(e.PrevNextService.adverts=[],e.PrevNextService.currentPage=0,e.PrevNextService.totalPage=0,e.PrevNextService.writeLocalStorage())},AdvertDetailController.prototype.refreshLazyLoad=function(){window.lazyLoadInstance&&window.lazyLoadInstance.update()},AdvertDetailController.prototype.interceptCtrlSAndShowFavoriteBox=function(){var t=this;document.addEventListener("keydown",function(e){if(e.ctrlKey&&83===e.which)return e.preventDefault(),t.$scope.$apply(function(){t.toggleFav()}),!1})},AdvertDetailController.prototype.linkToEditPage=function(r){var i=this;this.HttpHelperService.httpGet("/panelim/api/expressAdvert/save-advert-type",function(e){var t=!(20==e.Data);window.location.href=t?r:"/panelim/ilan-ver/duzenle?advertId="+i.advertId},function(e){},{isNotLoading:!0})},AdvertDetailController.prototype.bindSegmentifyCallbacks=function(){var o=this;window.segProducts=function(e,t,r){r&&r(jQuery("#detail-segmentify")),o.adverts=t,o.$scope.$digest();var i=6<o.adverts.length?6:o.adverts.length;o.CommonHelperService.setDataLayer("Ilan Detay","Benzer Ilanlar Displayed",""+i,"gaEvent",!0)}},AdvertDetailController.prototype.getLastSeen=function(e){var t=this;t.HttpHelperService.httpGet("/membership/MemberLastAccessDate/"+e,function(e){e.Success&&(t.lastSeen=e.Data,t.lastSeen=t.calculateLastSeenValue(t.lastSeen))})},AdvertDetailController.prototype.calculateLastSeenValue=function(e){var t=this.moment(e),r=this.moment();if(r.diff(t,"minutes")<60)return"1 saatten az";var i=r.diff(t,"hours");if(i<24)return i+" saat önce";var o=r.diff(t,"days");if(o<7)return o+" gün önce";var a=r.diff(t,"weeks");return a<4?a+" hafta önce":"1 aydan fazla"},AdvertDetailController.prototype.getKaskoInformation=function(){var self=this;if(!self.insuranceLoaded&&self.advertId){var deferred_1=self.$q.defer();return self.insuranceLoading=!0,this.HttpHelperService.httpGetWithPromise("/advertDetail/insurance?id="+self.advertId+"&version=1",{isNotLoading:!0}).then(function(res){var nakedHtml=self.$sce.trustAsHtml(res),nakedTrustedHtml=self.$sce.valueOf(nakedHtml),container=document.getElementById("kasko-ajax-wrapper");container.innerHTML=nakedTrustedHtml,self.$compile(container)(self.$scope),eval(document.getElementById("insurance-tab-datalayer").textContent),self.insuranceLoaded=!0,self.insuranceLoading=!1,deferred_1.resolve()}).catch(function(){self.insuranceLoaded=!1,self.insuranceLoading=!1,deferred_1.reject()}),deferred_1.promise}},AdvertDetailController.prototype.setFirst=function(){var t=this;t.credit.MaturityList.map(function(e){e.Selected&&(t.InstallmentAmount=e.InstallmentAmount,t.Url=e.Url)})},AdvertDetailController.prototype.creditAmountDots=function(e){var t=e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.");return this.credit.CreditableAmount=t},AdvertDetailController.prototype.installmentAmountDots=function(e){var t=e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.");return this.InstallmentAmount=t},AdvertDetailController.prototype.changePeriod=function(t){var r=this;r.credit.MaturityList.map(function(e){e.Maturity==t&&(r.InstallmentAmount=e.InstallmentAmount,r.Url=e.Url,r.installmentAmountDots(r.InstallmentAmount))})},AdvertDetailController.prototype.recalculate=function(e,t,r){var o=this;null!=e&&(e=e.toString().replace(".",""),o.credit.CreditableAmount=o.credit.CreditableAmount.toString().replace(".",""),e<999||null==e||(null!=t&&null!=t||o.credit.MaturityList.map(function(e){e.Selected&&(t=e.Maturity)}),o.HttpHelperService.httpGet("/advertDetail/credit?id="+r+"&maturity="+t+"&creditAmount="+e,function(e){e.Data.map(function(i){o.credit.MaturityList.map(function(e){if(e.Maturity==i.Maturity&&(e.InstallmentAmount=i.InstallmentAmount,e.Url=i.Url,i.Selected)){o.Url=i.Url;var t=i.InstallmentAmount.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1."),r=o.credit.CreditableAmount.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.");o.credit.CreditableAmount=r,o.InstallmentAmount=t}})})})))},AdvertDetailController.prototype.deleteAdvert=function(t,e){var r=this;r.DialogService.openConfirm(function(){r.HttpHelperService.httpPost("/api/deleteAdvert",{id:t},function(e){e.Success&&(window.Segmentify("view:product",{productId:t,inStock:!1,noUpdate:["categories","category","image","params","price","title","url","brand"]}),r.DialogService.success({message:"Ilanınız silinmiştir."}),setTimeout(function(){window.location.href="/panelim/ilanlar/liste/yayinda-olmayanlar?returnUrl="+window.location.href},1903))})},{headerOptions:{title:"Silme İşlemi Geri Alınamaz!"},bodyOptions:{message:"'"+e+"' ilanınız kalıcı olarak silinecek. Sildiğiniz ilanları tekrar geri getiremezsiniz.",warning:"İlanınızı kalıcı olarak silmek istediğinizden emin misiniz?"},footerOptions:{acceptLabel:"Kalıcı olarak sil",rejectLabel:"Vazgeç"}})},AdvertDetailController.prototype.setDfpTag=function(e){googletag.cmd.push(function(){googletag.pubads().setTargeting("actiontype",e)})},AdvertDetailController.prototype.getTramerRecord=function(e){var t=this,r=this;if(e.$valid&&this.plateForTramer)if(this.patternRuleSetForTramer(this.plateForTramer)){var i=function(){t.HttpHelperService.httpPostWithPromise("/damageQuery/create-order",{Value:t.plateForTramer.toUpperCase(),Type:10}).then(function(e){e.Success?window.location.href=e.Data:t.DialogService.warning({iconClass:"icon-arabam-info color-red4 tac icon-size-64 mb16",error:e.Message||e})}).catch(function(e){t.DialogService.warning({error:e.Message||e})})};this.tramerPatternFailed=!1,this.$rootScope.Properties.IsUserLoggedIn?i():this.callLoginDialog(function(){r.DialogService.closeAll(),i()})}else this.tramerPatternFailed=!0},AdvertDetailController.prototype.patternRuleSetForTramer=function(e){var t=e.replace(/\s+/g,"").toUpperCase();return/^(0[1-9]|[1-7][0-9]|8[01])([A-PR-VYZ](\d{4,5})|[A-PR-VYZ]{2}(\d{3,4})|[A-PR-VYZ]{3}(\d{2,3}))$/.test(t)},AdvertDetailController.prototype.tramerKeyup=function(){this.tramerPatternFailed=!1,this.plateForTramer&&(this.plateForTramer=this.plateForTramer.replace(/\s+/g,""))},AdvertDetailController.$inject=["$window","HttpHelperService","DialogService","CompareService","$scope","$timeout","CommonHelperService","$templateCache","$rootScope","PrevNextService","$location","$q","$sce","$compile","arabamConfigFactory","moment"],AdvertDetailController}();angular.module("arabam").controller("AdvertDetailController",AdvertDetailController)}(arabam||(arabam={}));
//# sourceMappingURL=advertDetail.min.js.map
